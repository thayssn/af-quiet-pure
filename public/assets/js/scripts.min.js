var acc = document.getElementsByClassName("question");
var i;

for (i = 0; i < acc.length; i++) {
    acc[i].addEventListener("click", function() {
        this.classList.toggle("active");

        var answer = this.nextElementSibling;
        if (answer.style.maxHeight) {
            answer.style.maxHeight = null;
        } else {
            answer.style.maxHeight = answer.scrollHeight + "px";
        }
    });
}

var seeMore = document.querySelector('#seemore');
var accordionItem = document.querySelectorAll('.accordion__item.hidden')

seeMore.addEventListener('click', function(e){
  e.preventDefault();
  accordionItem.forEach(function(item){
    item.classList.remove('hidden');
  })
  seeMore.style.display =  'none';
});

  var backURL = 'https://hotsite-dinamo.azurewebsites.net/';
  var chapters = document.querySelectorAll('.chapter__wrapper');
  var modal = document.querySelector('.modal')
  var layers = document.querySelectorAll('.modal__wrapper')

  function ajax(config) {
    var xhr = new XMLHttpRequest();
    xhr.open(config.method, config.url, true);
    xhr.setRequestHeader('Content-Type', config.contentType);
    xhr.onload = function () {
      if (xhr.status === 200) {
        if (config.success)
          config.success(xhr.responseText);
      }
      else {
        if (config.fail)
          config.fail(xhr.responseText);
      }
    };
    xhr.send(JSON.stringify(config.data));
  }

  function getChapters() {
    ajax({
      url: backURL + 'api/v1/chapters',
      method: 'GET',
      contentType: 'application/json',
      success: function (response) {
        var chaptersList = JSON.parse(response)
        setupChapters(chaptersList.data)
      }
    })
  }

  function registerUser(type) {
    var name = type == 'sign-up' ? document.querySelector('#register-name').value : null;
    var email = type == 'sign-up' ? document.querySelector('#register-email').value : document.querySelector('#sign_in_mail').value || localStorage.user ;
    var type = type == 'sign-up' ? document.querySelector('#register-type').value : null;

    if(type == 'sign-up' && (!name || !email || !type)) {
      document.querySelector('.modal_error').textContent = 'Por favor, preencha todos os campos';
    }else{
      document.querySelector('.modal_error').textContent = '';

      var data = {
        customer: {
          name: name,
          email: email,
          type: type
        },
        chapterId: modal.dataset.chapterId
      };

      ajax({
        url: backURL + 'api/v1/customers/new',
        method: 'POST',
        contentType: 'application/json',
        data: data,
        success: function (response) {
          response = JSON.parse(response)
          if(response.status == "Success"){
            document.querySelector('#download-link').href = backURL + response.data.url;
            localStorage.user = email;
            goTo('#download');
          }else{
            if(response.message === 'No file found'){
              goTo('#ops');
            }else{
              goTo('#ops-register');
            }
          }
        },
        fail: function () {
          goTo('#ops-register');
        }
      })
    }
  }

  function setupChapters(chaptersList) {
    var chaps = Object.values(chaptersList)
    chapters.forEach(function (chapter) {
      var chap = chaps.find(c => c.chapter == chapter.dataset.chapter);
      console.log(chap);
      chapter.classList.add('active--' + chap.is_active);
      chapter.querySelector('.chapter__title').textContent = chap.name;
      chapter.querySelector('.chapter__label__number').textContent = chap.chapter;
      chapter.querySelector('.chapter__description').textContent = chap.is_active ? 'Dispon√≠vel' : 'Previsto para ' + chapter.dataset.release;
      chapter.querySelector('.chapter__box__bg').style.background = chap.color;

      chapter.addEventListener('click', function (e) {
        e.preventDefault();
        openModal(chap);
      });
    })
  }


  function closeModal() {
    modal.style.display = 'none';
  }

  function hideLayers() {
    layers.forEach(function (layer) {
      layer.style.display = 'none';
    })
  }

  function goTo(layer) {
    var activeLayer = document.querySelector(layer)
    hideLayers();
    activeLayer.style.display = 'initial';
  }

  function getLink() {
    // TODO pegar o link para um usuario ja cadastrado
    goTo('#download')
  }

  function openModal(chapter) {
    var loggedIn = localStorage.user ? true : false;

    modal.style.display = 'flex';
    modal.dataset.chapterId = chapter.id;

    if (loggedIn) {
      if (chapter.is_active) {
        registerUser('sign-in', chapter);
      } else {
        goTo('#ops');
      }
    } else {
      goTo('#sign-up');
    }
  }

  getChapters();

  var header = document.querySelector('header');
  var content = document.querySelector('main');
  var menu = header.querySelector('.menu');
  var menuBtn = header.querySelector('#openMenu');
  var headerInitialTop = header.offsetTop;
  var lastPosition = 0;
  var ticking = false;
  var links = document.querySelectorAll('header li')

  links.forEach(function(link){
    link.addEventListener('click', function(e){
      e.preventDefault();
      var anchor = this.querySelector('a');
      var target = document.querySelector(anchor.getAttribute('href'));

      window.scroll({
        top: (target.offsetTop - 120),
        behavior: 'smooth',
      });

      if(window.innerWidth < 992){
        closeMenu();
      }
    })
  })

  window.addEventListener('resize', function() {
    if(window.innerWidth > 991){
      fixHeader(window.scrollY);
    }
  })


  function fixHeader(scrollPosition){
    if(scrollPosition >= headerInitialTop){
      header.classList.add('header--fixed');
    }else{
      header.classList.remove('header--fixed');
    }
  }

  window.addEventListener('scroll', function() {
    lastPosition = window.scrollY;
    if(!ticking){
      window.requestAnimationFrame(() => {
        fixHeader(lastPosition);
        ticking = false;
      });
    }
    ticking = true;
  });

  function openMenu(){
    menuBtn.classList.add('active');
    menu.classList.add('active');
  }

  function closeMenu(){
    menuBtn.classList.remove('active');
    menu.classList.remove('active');
  }

  menuBtn.addEventListener('click', function(e){
    e.preventDefault();
    if(menuBtn.classList.contains('active')){
      closeMenu();
    }else{
      openMenu();
    }
  })

var modal = document.querySelector('.modal');
var modal_title = modal.querySelector('.modal__title');
var modal_form = modal.querySelector('form');
var modal_close = modal.querySelector('.modal__close');
var modal_row = modal.querySelector('.row');

modal_form.addEventListener('submit', function(e){
  e.preventDefault();
  var obg = document.createElement('h3');
  obg.textContent = 'Obrigado!';
  obg.style.margin = '0 auto';
  modal_row.innerHTML = '';
  modal_row.appendChild(obg);
  return false;
})

modal_close.addEventListener('click', function(){
  modal.classList.add('hidden');
})

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjY29yZGlvbi5qcyIsImFqYXguanMiLCJoZWFkZXIuanMiLCJtb2RhbC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeklBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJzY3JpcHRzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBhY2MgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwicXVlc3Rpb25cIik7XHJcbnZhciBpO1xyXG5cclxuZm9yIChpID0gMDsgaSA8IGFjYy5sZW5ndGg7IGkrKykge1xyXG4gICAgYWNjW2ldLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcclxuICAgICAgICB0aGlzLmNsYXNzTGlzdC50b2dnbGUoXCJhY3RpdmVcIik7XHJcblxyXG4gICAgICAgIHZhciBhbnN3ZXIgPSB0aGlzLm5leHRFbGVtZW50U2libGluZztcclxuICAgICAgICBpZiAoYW5zd2VyLnN0eWxlLm1heEhlaWdodCkge1xyXG4gICAgICAgICAgICBhbnN3ZXIuc3R5bGUubWF4SGVpZ2h0ID0gbnVsbDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBhbnN3ZXIuc3R5bGUubWF4SGVpZ2h0ID0gYW5zd2VyLnNjcm9sbEhlaWdodCArIFwicHhcIjtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5cclxudmFyIHNlZU1vcmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc2VlbW9yZScpO1xyXG52YXIgYWNjb3JkaW9uSXRlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5hY2NvcmRpb25fX2l0ZW0uaGlkZGVuJylcclxuXHJcbnNlZU1vcmUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKXtcclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgYWNjb3JkaW9uSXRlbS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe1xyXG4gICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcclxuICB9KVxyXG4gIHNlZU1vcmUuc3R5bGUuZGlzcGxheSA9ICAnbm9uZSc7XHJcbn0pO1xyXG4iLCIgIHZhciBiYWNrVVJMID0gJ2h0dHBzOi8vaG90c2l0ZS1kaW5hbW8uYXp1cmV3ZWJzaXRlcy5uZXQvJztcclxuICB2YXIgY2hhcHRlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2hhcHRlcl9fd3JhcHBlcicpO1xyXG4gIHZhciBtb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbCcpXHJcbiAgdmFyIGxheWVycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tb2RhbF9fd3JhcHBlcicpXHJcblxyXG4gIGZ1bmN0aW9uIGFqYXgoY29uZmlnKSB7XHJcbiAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcbiAgICB4aHIub3Blbihjb25maWcubWV0aG9kLCBjb25maWcudXJsLCB0cnVlKTtcclxuICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCBjb25maWcuY29udGVudFR5cGUpO1xyXG4gICAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgaWYgKHhoci5zdGF0dXMgPT09IDIwMCkge1xyXG4gICAgICAgIGlmIChjb25maWcuc3VjY2VzcylcclxuICAgICAgICAgIGNvbmZpZy5zdWNjZXNzKHhoci5yZXNwb25zZVRleHQpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGlmIChjb25maWcuZmFpbClcclxuICAgICAgICAgIGNvbmZpZy5mYWlsKHhoci5yZXNwb25zZVRleHQpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgeGhyLnNlbmQoSlNPTi5zdHJpbmdpZnkoY29uZmlnLmRhdGEpKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGdldENoYXB0ZXJzKCkge1xyXG4gICAgYWpheCh7XHJcbiAgICAgIHVybDogYmFja1VSTCArICdhcGkvdjEvY2hhcHRlcnMnLFxyXG4gICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICB2YXIgY2hhcHRlcnNMaXN0ID0gSlNPTi5wYXJzZShyZXNwb25zZSlcclxuICAgICAgICBzZXR1cENoYXB0ZXJzKGNoYXB0ZXJzTGlzdC5kYXRhKVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcmVnaXN0ZXJVc2VyKHR5cGUpIHtcclxuICAgIHZhciBuYW1lID0gdHlwZSA9PSAnc2lnbi11cCcgPyBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcmVnaXN0ZXItbmFtZScpLnZhbHVlIDogbnVsbDtcclxuICAgIHZhciBlbWFpbCA9IHR5cGUgPT0gJ3NpZ24tdXAnID8gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3JlZ2lzdGVyLWVtYWlsJykudmFsdWUgOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc2lnbl9pbl9tYWlsJykudmFsdWUgfHwgbG9jYWxTdG9yYWdlLnVzZXIgO1xyXG4gICAgdmFyIHR5cGUgPSB0eXBlID09ICdzaWduLXVwJyA/IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNyZWdpc3Rlci10eXBlJykudmFsdWUgOiBudWxsO1xyXG5cclxuICAgIGlmKHR5cGUgPT0gJ3NpZ24tdXAnICYmICghbmFtZSB8fCAhZW1haWwgfHwgIXR5cGUpKSB7XHJcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9lcnJvcicpLnRleHRDb250ZW50ID0gJ1BvciBmYXZvciwgcHJlZW5jaGEgdG9kb3Mgb3MgY2FtcG9zJztcclxuICAgIH1lbHNle1xyXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfZXJyb3InKS50ZXh0Q29udGVudCA9ICcnO1xyXG5cclxuICAgICAgdmFyIGRhdGEgPSB7XHJcbiAgICAgICAgY3VzdG9tZXI6IHtcclxuICAgICAgICAgIG5hbWU6IG5hbWUsXHJcbiAgICAgICAgICBlbWFpbDogZW1haWwsXHJcbiAgICAgICAgICB0eXBlOiB0eXBlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBjaGFwdGVySWQ6IG1vZGFsLmRhdGFzZXQuY2hhcHRlcklkXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBhamF4KHtcclxuICAgICAgICB1cmw6IGJhY2tVUkwgKyAnYXBpL3YxL2N1c3RvbWVycy9uZXcnLFxyXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgIHJlc3BvbnNlID0gSlNPTi5wYXJzZShyZXNwb25zZSlcclxuICAgICAgICAgIGlmKHJlc3BvbnNlLnN0YXR1cyA9PSBcIlN1Y2Nlc3NcIil7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNkb3dubG9hZC1saW5rJykuaHJlZiA9IGJhY2tVUkwgKyByZXNwb25zZS5kYXRhLnVybDtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnVzZXIgPSBlbWFpbDtcclxuICAgICAgICAgICAgZ29UbygnI2Rvd25sb2FkJyk7XHJcbiAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgaWYocmVzcG9uc2UubWVzc2FnZSA9PT0gJ05vIGZpbGUgZm91bmQnKXtcclxuICAgICAgICAgICAgICBnb1RvKCcjb3BzJyk7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgIGdvVG8oJyNvcHMtcmVnaXN0ZXInKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZmFpbDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgZ29UbygnI29wcy1yZWdpc3RlcicpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHNldHVwQ2hhcHRlcnMoY2hhcHRlcnNMaXN0KSB7XHJcbiAgICB2YXIgY2hhcHMgPSBPYmplY3QudmFsdWVzKGNoYXB0ZXJzTGlzdClcclxuICAgIGNoYXB0ZXJzLmZvckVhY2goZnVuY3Rpb24gKGNoYXB0ZXIpIHtcclxuICAgICAgdmFyIGNoYXAgPSBjaGFwcy5maW5kKGMgPT4gYy5jaGFwdGVyID09IGNoYXB0ZXIuZGF0YXNldC5jaGFwdGVyKTtcclxuICAgICAgY29uc29sZS5sb2coY2hhcCk7XHJcbiAgICAgIGNoYXB0ZXIuY2xhc3NMaXN0LmFkZCgnYWN0aXZlLS0nICsgY2hhcC5pc19hY3RpdmUpO1xyXG4gICAgICBjaGFwdGVyLnF1ZXJ5U2VsZWN0b3IoJy5jaGFwdGVyX190aXRsZScpLnRleHRDb250ZW50ID0gY2hhcC5uYW1lO1xyXG4gICAgICBjaGFwdGVyLnF1ZXJ5U2VsZWN0b3IoJy5jaGFwdGVyX19sYWJlbF9fbnVtYmVyJykudGV4dENvbnRlbnQgPSBjaGFwLmNoYXB0ZXI7XHJcbiAgICAgIGNoYXB0ZXIucXVlcnlTZWxlY3RvcignLmNoYXB0ZXJfX2Rlc2NyaXB0aW9uJykudGV4dENvbnRlbnQgPSBjaGFwLmlzX2FjdGl2ZSA/ICdEaXNwb27DrXZlbCcgOiAnUHJldmlzdG8gcGFyYSAnICsgY2hhcHRlci5kYXRhc2V0LnJlbGVhc2U7XHJcbiAgICAgIGNoYXB0ZXIucXVlcnlTZWxlY3RvcignLmNoYXB0ZXJfX2JveF9fYmcnKS5zdHlsZS5iYWNrZ3JvdW5kID0gY2hhcC5jb2xvcjtcclxuXHJcbiAgICAgIGNoYXB0ZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICBvcGVuTW9kYWwoY2hhcCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSlcclxuICB9XHJcblxyXG5cclxuICBmdW5jdGlvbiBjbG9zZU1vZGFsKCkge1xyXG4gICAgbW9kYWwuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGhpZGVMYXllcnMoKSB7XHJcbiAgICBsYXllcnMuZm9yRWFjaChmdW5jdGlvbiAobGF5ZXIpIHtcclxuICAgICAgbGF5ZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBnb1RvKGxheWVyKSB7XHJcbiAgICB2YXIgYWN0aXZlTGF5ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGxheWVyKVxyXG4gICAgaGlkZUxheWVycygpO1xyXG4gICAgYWN0aXZlTGF5ZXIuc3R5bGUuZGlzcGxheSA9ICdpbml0aWFsJztcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGdldExpbmsoKSB7XHJcbiAgICAvLyBUT0RPIHBlZ2FyIG8gbGluayBwYXJhIHVtIHVzdWFyaW8gamEgY2FkYXN0cmFkb1xyXG4gICAgZ29UbygnI2Rvd25sb2FkJylcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIG9wZW5Nb2RhbChjaGFwdGVyKSB7XHJcbiAgICB2YXIgbG9nZ2VkSW4gPSBsb2NhbFN0b3JhZ2UudXNlciA/IHRydWUgOiBmYWxzZTtcclxuXHJcbiAgICBtb2RhbC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnO1xyXG4gICAgbW9kYWwuZGF0YXNldC5jaGFwdGVySWQgPSBjaGFwdGVyLmlkO1xyXG5cclxuICAgIGlmIChsb2dnZWRJbikge1xyXG4gICAgICBpZiAoY2hhcHRlci5pc19hY3RpdmUpIHtcclxuICAgICAgICByZWdpc3RlclVzZXIoJ3NpZ24taW4nLCBjaGFwdGVyKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBnb1RvKCcjb3BzJyk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGdvVG8oJyNzaWduLXVwJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXRDaGFwdGVycygpO1xyXG4iLCIgIHZhciBoZWFkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdoZWFkZXInKTtcclxuICB2YXIgY29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ21haW4nKTtcclxuICB2YXIgbWVudSA9IGhlYWRlci5xdWVyeVNlbGVjdG9yKCcubWVudScpO1xyXG4gIHZhciBtZW51QnRuID0gaGVhZGVyLnF1ZXJ5U2VsZWN0b3IoJyNvcGVuTWVudScpO1xyXG4gIHZhciBoZWFkZXJJbml0aWFsVG9wID0gaGVhZGVyLm9mZnNldFRvcDtcclxuICB2YXIgbGFzdFBvc2l0aW9uID0gMDtcclxuICB2YXIgdGlja2luZyA9IGZhbHNlO1xyXG4gIHZhciBsaW5rcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2hlYWRlciBsaScpXHJcblxyXG4gIGxpbmtzLmZvckVhY2goZnVuY3Rpb24obGluayl7XHJcbiAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSl7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgdmFyIGFuY2hvciA9IHRoaXMucXVlcnlTZWxlY3RvcignYScpO1xyXG4gICAgICB2YXIgdGFyZ2V0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihhbmNob3IuZ2V0QXR0cmlidXRlKCdocmVmJykpO1xyXG5cclxuICAgICAgd2luZG93LnNjcm9sbCh7XHJcbiAgICAgICAgdG9wOiAodGFyZ2V0Lm9mZnNldFRvcCAtIDEyMCksXHJcbiAgICAgICAgYmVoYXZpb3I6ICdzbW9vdGgnLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGlmKHdpbmRvdy5pbm5lcldpZHRoIDwgOTkyKXtcclxuICAgICAgICBjbG9zZU1lbnUoKTtcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9KVxyXG5cclxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZnVuY3Rpb24oKSB7XHJcbiAgICBpZih3aW5kb3cuaW5uZXJXaWR0aCA+IDk5MSl7XHJcbiAgICAgIGZpeEhlYWRlcih3aW5kb3cuc2Nyb2xsWSk7XHJcbiAgICB9XHJcbiAgfSlcclxuXHJcblxyXG4gIGZ1bmN0aW9uIGZpeEhlYWRlcihzY3JvbGxQb3NpdGlvbil7XHJcbiAgICBpZihzY3JvbGxQb3NpdGlvbiA+PSBoZWFkZXJJbml0aWFsVG9wKXtcclxuICAgICAgaGVhZGVyLmNsYXNzTGlzdC5hZGQoJ2hlYWRlci0tZml4ZWQnKTtcclxuICAgIH1lbHNle1xyXG4gICAgICBoZWFkZXIuY2xhc3NMaXN0LnJlbW92ZSgnaGVhZGVyLS1maXhlZCcpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgbGFzdFBvc2l0aW9uID0gd2luZG93LnNjcm9sbFk7XHJcbiAgICBpZighdGlja2luZyl7XHJcbiAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4ge1xyXG4gICAgICAgIGZpeEhlYWRlcihsYXN0UG9zaXRpb24pO1xyXG4gICAgICAgIHRpY2tpbmcgPSBmYWxzZTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICB0aWNraW5nID0gdHJ1ZTtcclxuICB9KTtcclxuXHJcbiAgZnVuY3Rpb24gb3Blbk1lbnUoKXtcclxuICAgIG1lbnVCdG4uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcbiAgICBtZW51LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gY2xvc2VNZW51KCl7XHJcbiAgICBtZW51QnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xyXG4gICAgbWVudS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcclxuICB9XHJcblxyXG4gIG1lbnVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKXtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIGlmKG1lbnVCdG4uY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKSl7XHJcbiAgICAgIGNsb3NlTWVudSgpO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgIG9wZW5NZW51KCk7XHJcbiAgICB9XHJcbiAgfSlcclxuIiwidmFyIG1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsJyk7XHJcbnZhciBtb2RhbF90aXRsZSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fdGl0bGUnKTtcclxudmFyIG1vZGFsX2Zvcm0gPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCdmb3JtJyk7XHJcbnZhciBtb2RhbF9jbG9zZSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcclxudmFyIG1vZGFsX3JvdyA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5yb3cnKTtcclxuXHJcbm1vZGFsX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgZnVuY3Rpb24oZSl7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIHZhciBvYmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMycpO1xyXG4gIG9iZy50ZXh0Q29udGVudCA9ICdPYnJpZ2FkbyEnO1xyXG4gIG9iZy5zdHlsZS5tYXJnaW4gPSAnMCBhdXRvJztcclxuICBtb2RhbF9yb3cuaW5uZXJIVE1MID0gJyc7XHJcbiAgbW9kYWxfcm93LmFwcGVuZENoaWxkKG9iZyk7XHJcbiAgcmV0dXJuIGZhbHNlO1xyXG59KVxyXG5cclxubW9kYWxfY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpe1xyXG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xyXG59KVxyXG4iXX0=
